<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Winter Assignment Portal | Zone Wagoora</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; -webkit-tap-highlight-color: transparent; }
        .app-gradient { background: linear-gradient(135deg, #6366f1 0%, #4338ca 100%); }
        .input-style { @apply w-full p-4 rounded-2xl bg-slate-100 border-none focus:ring-2 focus:ring-indigo-500 transition-all outline-none; }
        .tab-active { @apply text-indigo-600; }
        .tab-inactive { @apply text-slate-300; }
        .quiz-option { @apply w-full p-4 bg-white border-2 border-slate-100 rounded-2xl text-left font-bold text-slate-600 active:scale-95 transition-all flex justify-between items-center mb-3; }
        .dev-footer { font-size: 10px; text-transform: uppercase; letter-spacing: 1px; font-weight: 800; opacity: 0.6; text-align: center; color: #6366f1; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">

    <div id="auth-screen" class="min-h-screen flex flex-col items-center justify-center p-6">
        <div class="w-full max-w-md bg-white rounded-[2.5rem] shadow-2xl p-8 border border-slate-100">
            <div class="text-center mb-8">
                <div class="w-16 h-16 app-gradient rounded-3xl mx-auto mb-4 flex items-center justify-center shadow-lg"><i class="fas fa-graduation-cap text-white text-2xl"></i></div>
                <h1 class="text-2xl font-black text-slate-800 tracking-tight">Zone Wagoora</h1>
                <p class="text-slate-500 text-sm italic">Winter Assignment Portal</p>
            </div>

            <div id="login-box" class="space-y-4">
                <input type="email" id="login-email" placeholder="Email Address" class="input-style">
                <input type="password" id="login-pass" placeholder="Password" class="input-style">
                <button onclick="handleLogin()" class="w-full app-gradient text-white font-bold py-4 rounded-2xl shadow-lg active:scale-95 transition-all">Sign In</button>
                <p class="text-center text-sm text-slate-500 mt-4">New user? <span onclick="toggleView()" class="text-indigo-600 font-bold cursor-pointer underline">Register</span></p>
            </div>

            <div class="mt-10 text-center">
                <p class="dev-footer">Designed & Developed By</p>
                <p class="text-xs font-bold text-slate-800">Mohammad Ashraf Rather</p>
                <p class="text-[10px] text-slate-400">Teacher GPS Pethgam Wagoora</p>
            </div>
        </div>
    </div>

    <div id="app-dashboard" class="hidden min-h-screen pb-40">
        <div class="app-gradient p-8 pb-20 rounded-b-[3rem] text-white shadow-xl relative">
            <div class="flex justify-between items-start mb-6">
                <div>
                    <h2 id="display-name" class="text-2xl font-black">Welcome!</h2>
                    <p id="display-sub" class="text-indigo-100 text-xs font-bold uppercase tracking-widest opacity-80"></p>
                </div>
                <button onclick="logout()" class="w-10 h-10 bg-white/10 rounded-full flex items-center justify-center"><i class="fas fa-sign-out-alt"></i></button>
            </div>
            
            <div class="bg-white/10 p-5 rounded-[2rem] backdrop-blur-md flex items-center gap-4 border border-white/10">
                <div class="w-12 h-12 rounded-full flex items-center justify-center text-xl bg-white/20"><i class="fas fa-medal"></i></div>
                <div>
                    <p class="text-[10px] uppercase font-black opacity-70">Coin Balance</p>
                    <p class="text-2xl font-black leading-none mt-1"><span id="display-coins">0</span></p>
                </div>
            </div>
        </div>

        <div class="px-6 -mt-10">
            <div id="tab-home" class="grid grid-cols-2 gap-4"></div>
        </div>

        <nav class="fixed bottom-0 left-0 right-0 bg-white border-t p-5 flex justify-around shadow-2xl">
            <button onclick="location.reload()" class="text-indigo-600"><i class="fas fa-home text-xl"></i></button>
            <button onclick="logout()" class="text-slate-300"><i class="fas fa-user text-xl"></i></button>
        </nav>
    </div>

    <script>
        // Use YOUR Firebase config here
        const firebaseConfig = {
            apiKey: "AIzaSyBcRfUj9N_9LaVuEuIT7d0ueJ88heyP9hI",
            authDomain: "wagoora-edu-portal.firebaseapp.com",
            projectId: "wagoora-edu-portal",
            storageBucket: "wagoora-edu-portal.firebasestorage.app",
            messagingSenderId: "476444772096",
            appId: "1:476444772096:web:6fd360cc0a774f94a1d5e5"
        };
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // Updated Login Function
        async function handleLogin() {
            const email = document.getElementById('login-email').value.trim();
            const pass = document.getElementById('login-pass').value;

            if(!email || !pass) {
                alert("Please enter both email and password.");
                return;
            }

            try {
                const userCredential = await auth.signInWithEmailAndPassword(email, pass);
                const uid = userCredential.user.uid;

                // Fetch data from Firestore
                const userDoc = await db.collection("users").doc(uid).get();
                
                if (userDoc.exists) {
                    const userData = userDoc.data();
                    
                    if (userData.approved) {
                        showDashboard(userData);
                    } else {
                        alert("Account found, but awaiting HOI Approval. Please contact your school.");
                        auth.signOut();
                    }
                } else {
                    alert("User record not found in database.");
                }
            } catch (error) {
                console.error("Login Error:", error.code);
                alert("Login Failed: " + error.message);
            }
        }

        function showDashboard(user) {
            document.getElementById('auth-screen').classList.add('hidden');
            document.getElementById('app-dashboard').classList.remove('hidden');
            
            document.getElementById('display-name').innerText = user.fullName;
            document.getElementById('display-sub').innerText = `Class ${user.grade} | ${user.school}`;
            document.getElementById('display-coins').innerText = user.coins || 0;

            renderSubjects(user.grade, user.role);
        }

        function renderSubjects(grade, role) {
            const grid = document.getElementById('tab-home');
            grid.innerHTML = '';
            let subs = ["English", "Mathematics", "Urdu", "Kashmiri"];
            
            if (role === 'teacher') {
                subs = ["English", "Mathematics", "Urdu", "Kashmiri", "EVS", "Science", "Social Studies"];
            } else {
                if (["3rd", "4th", "5th"].includes(grade)) subs.push("EVS");
                if (["6th", "7th", "8th"].includes(grade)) subs.push("EVS", "Science", "Social Studies");
            }

            subs.forEach(s => {
                grid.innerHTML += `
                    <div class="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 flex flex-col items-center justify-center">
                        <div class="w-12 h-12 bg-indigo-50 text-indigo-600 rounded-2xl flex items-center justify-center mb-2"><i class="fas fa-book"></i></div>
                        <span class="font-bold text-xs">${s}</span>
                    </div>`;
            });
        }

        function toggleView() { alert("Registration is currently handled via HOI. Please log in with your assigned credentials."); }
        function logout() { auth.signOut().then(() => location.reload()); }
    </script>
</body>
</html>
                                            
